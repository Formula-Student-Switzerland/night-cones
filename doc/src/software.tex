\section{Software}
The software chapter describes all the code that runs on the computer, with which the operator controls all nightcones in the local network. This computer is denoted as \textit{Host}.  The software consists of various functional blocks that are summarized in the first subchapter. Each module is then explained in detail in the following subchapters. 
\subsection{Concept}
The software will be split into multiple modules, which should be able to be developed stand-alone. The modules are shortly described in this section. \\

There is one part that will be used in multiple modules. The map allowing to position the cones and show the states and allow to interact with the cones shall be the same for all modules. 


\subsubsection{Logger}
The logger module is responsible to handle all messages generated by the other modules and create log files and user messages accordingly. 

\textbf{Functions:}
\begin{itemize}
	\item Create long term log files for all relevant cones data (eg. Battery level, \ac{RSSI} etc)
	\item Store relevant Warnings, Errors and Failures with configurable level in a local log file. 
\end{itemize}

\textbf{Input:}
\begin{itemize}
	\item Log messages 
\end{itemize}

\textbf{Output:}
\begin{itemize}
	\item Log messanges to \ac{GUI}
	\item Log file
\end{itemize}


\subsubsection{Host-Network Interface}
The Host-Network Interface is responsible for everything that runs on the network interface. It handles all the communication to and from the cones. 

\textbf{Functions:}
\begin{itemize}
	\item List all available networks
	\item List all available Cones in a specific network
	\item Turn of a single cone or all cones in the network
	\item Stream data to cones
	\item List all cones information
	\item Set specific settings on cone
\end{itemize}

\textbf{Input:}

\begin{itemize}
	\item All data from network
	\item Current state from cones
	\item Current demanded light state
	\item Demanded settings
\end{itemize}

\textbf{Output:}
\begin{itemize}
	\item Received cone data
	\item Log messages
	\item Data transfer from and to the cones
\end{itemize}

\subsubsection{Network Manager}
The Network Manager is a simple \ac{GUI} used to interface with the Host-Network Interface. It allows to alter settings of the cones, perform \ac{OTA} updates and observe the current state of the cones. 

\textbf{Functions: }

\begin{itemize}
	\item Show all cones in a network
	\item Select a network
	\item Change settings of cones in network
	\item Activate/deactivate cones
	\item Software update
	\item Show current data of the cones
	\item Identify cones
	\item Show cones on air image or on map / custom map
	\item Draw on Map or air image
	\item Override current cone state
\end{itemize}

\textbf{Input:}

\begin{itemize}
	\item Available scenarios
	\item Current data
	\item interface to Host-Network-Interface
\end{itemize}

\textbf{Output:}
\begin{itemize}
	\item \ac{GUI}
\end{itemize}

\subsubsection{Scenario Designer/Manager}
The scenario Designer/Manager is used to design and apply  scenarios to all cones. The idea behind this module is on one side to create a project (eg. Skidpad) with various scenarios. Each scenario can be a single state or a time/manually stepped sequence of steps (eg. start: All dark, green animation, All green, yellow cones yellow, blue cones blue). Afterwards it should be possible to easy use these prepared scenarios. This could be done in a second view and should use keyboard shortcuts. 

\textbf{Functions: }
\begin{itemize}
	\item Play back static or dynamic scenario
	\item Prepare/design scenarios
	\item save/load scenarios
\end{itemize}

\textbf{Input:}
\begin{itemize}
	\item User Input
\end{itemize}

\textbf{Output:}
\begin{itemize}
	\item Scenarios to directly use inside project
	\item Saved scenarios
\end{itemize}

\subsubsection{Simulator}
the simulator shall be a drop in replacement to the Host-Network-Interface. It therefore shall not simulate the communication itself. It can be used to test the other modules, when no 100 Cones are available. It should behave the same as the host network interface and should be able to be selected as a possible network in the Network Manager. \\
The simulator shall also give the possibility to change the values of the cones (eg. Activate the Hall sensor, Change battery level etc).

\textbf{Functions: }
\begin{itemize}
	\item Show current light state of a cone on a map. 
	\item Move cones on the map/background
	\item Activate hall sensor
	\item Change \ac{SoC}
	\item Change \ac{RSSI}
\end{itemize}

\textbf{Input:}
\begin{itemize}
	\item Interface to Network Manager
	\item User inputs via \ac{GUI}
\end{itemize}

\textbf{Output:}

\begin{itemize}
	\item Visualisation
\end{itemize}



\subsection{Logger}
The python module \texttt{Logging} is used for logging in the whole application. This makes it extremely simple to log any events. The logger is configured in the top module \texttt{LoggingManager}. The configuration itself is done using a \ac{JSON} formatted file. This file should be used by the user to tailor the logging behaviour if necessary. 
\subsubsection{HowTo Logging}
At least every large submodule as described above should have its own logger. If more loggers are needed, they can be created. Table  \ref{tab_logger} collects all loggers, that are created in the application. 
\begin{table}[h!]
	\centering
	\begin{zebratabular}{ll}
		\rowcolor{gray}
		Module &
		Logger Name \\
		Host-Network-Interface & NetworkInterface  \\
	\end{zebratabular}
	\caption{Logger Names}
	\label{tab_logger}
\end{table}

The logger can be created using \pythoninline{logger = logging.getLogger("your-best-logger-name")}. Creating messages is then pretty straight forward: 
\begin{python}
logger.debug("Debug message")
logger.info("Info message")
logger.warning("Warning message")
logger.error("Error message")
logger.critical("Critical message")
\end{python}

\subsubsection{LoggingManager}
The \texttt{LoggingManager} class together with the Handlers is used to filter and categorize the logger messages. 
\todo{Write Code and document it here}

\subsection{Host-Network-Interface}

This module is used to interface to any available network. 

\subsubsection{Command line Interface}
The Module features a command line Interace, which can be used by running the python file \texttt{NetworkInterface.py}. The available options and corresponding functions can primarily be looked up using the \texttt{-h/--help} switch. Commands that need more explanation are explained hereinafter.  



\subsection{Network Manager}




\subsection{Scenario Designer}






\subsection{Simulator}



\subsection{Licensing}

As this software is intended to be made open source in near or far future, the license thematic is an important topic. Therefore all python dependencies are listed in the following table. 

\begin{table}[h!]
	\centering
	\begin{zebratabular}{llll}
		\rowcolor{gray}
		Module &
		pip install name & 
		License & url \\
		\texttt{ifaddr} & \texttt{ifaddr}  & MIT &  \url{https://github.com/pydron/ifaddr} \\
	\end{zebratabular}
	\caption{Python Dependencies} 	
	\label{tab_py_dependencies}
\end{table}


